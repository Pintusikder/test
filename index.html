<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- PWA Meta Tags for iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ArthaNex">

    <title>ArthaNex - Offline Khata Book</title>
    <meta name="description"
        content="The ultimate Offline Khata Book & Daily Cash Collection App for small businesses. Track Income & Expenses, manage Party Ledger & Dues without internet. Best Billing & Collection Tracker for local shops.">
    <meta name="theme-color" content="#F36C21">

    <!-- Manifest Link -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" type="image/png" href="icon.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- HTML2PDF Library for Auto Download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        :root {
            --primary: #F36C21;
            /* Gerua / Orange */
            --primary-hover: #D65612;
            --accent: #FF8A3D;
            --secondary: #1C1C1C;
            --neutral: #6B6E63;
            --light-bg: #F5F5F5;
            --card-bg: #FFFFFF;
            --input-bg: #FFFFFF;
            --text-color: #1C1C1C;
            --border: #999999;

            --bg-income: #e8f5e9;
            --text-income: #2e7d32;
            --bg-expense: #ffebee;
            --text-expense: #c62828;
            --bg-balance: #e3f2fd;
            --text-balance: #1565c0;

            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);

            --history-text: #444444;
            --transition: all 0.3s ease;
            color-scheme: light;
        }

        [data-theme="dark"] {
            --secondary: #F5F5F5;
            --light-bg: #121212;
            --card-bg: #1e1e1e;
            --input-bg: #2c2c2c;
            --text-color: #F5F5F5;
            --border: #444444;
            --history-text: #cccccc;
            --bg-income: #1b3320;
            --text-income: #66bb6a;
            --bg-expense: #331515;
            --text-expense: #ef5350;
            --bg-balance: #0f2847;
            --text-balance: #42a5f5;
            color-scheme: dark;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light-bg);
            color: var(--secondary);
            font-size: 16px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            counter-reset: page 1;
        }

        /* Container to hold content for PDF generation (Fixed) */
        #pdf-render-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            min-height: 100%;
            background: #fff;
            color: #000;
            z-index: 10000;
            display: none;
            /* Hidden by default */
            overflow-y: auto;
        }

        #app-container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: var(--light-bg);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1;
        }

        /* HEADER */
        header {
            background-color: var(--primary);
            color: #fff;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            z-index: 10;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-direction: column;
            align-items: flex-start;
        }

        .brand-top {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .brand h1 {
            font-size: 1.25rem;
            font-weight: 700;
            margin: 0;
            line-height: 1;
        }

        .brand-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            overflow: hidden;
            flex-shrink: 0;
        }

        .brand-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
            padding: 2px;
        }

        .brand a {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            font-size: 0.7rem;
            opacity: 0.9;
            cursor: pointer;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.5);
            white-space: nowrap;
        }

        .brand a:hover {
            opacity: 1;
            color: #fff;
        }

        .header-actions button {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.6rem;
            cursor: pointer;
            padding: 8px 12px;
            margin-left: 8px;
            transition: var(--transition);
            line-height: 1;
        }

        .header-actions button:hover {
            transform: scale(1.1);
        }

        .dashboard-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            padding: 1rem;
            background-color: var(--light-bg);
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: var(--radius-md);
            padding: 0.8rem;
            text-align: center;
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 80px;
            border: 1px solid var(--border);
        }

        .stat-card.income {
            background-color: var(--bg-income);
            border-color: var(--text-income);
        }

        .stat-card.expense {
            background-color: var(--bg-expense);
            border-color: var(--text-expense);
        }

        .stat-card.balance {
            background-color: var(--bg-balance);
            border-color: var(--text-balance);
        }

        .stat-label {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            opacity: 0.8;
            margin-bottom: 5px;
            color: var(--text-income);
        }

        .stat-val {
            font-size: 1rem;
            font-weight: 700;
            font-family: 'Roboto Mono', monospace;
            color: var(--text-income);
            word-break: break-all;
            overflow-wrap: break-word;
            min-width: 0;
        }

        .stat-card.expense .stat-label,
        .stat-card.expense .stat-val {
            color: var(--text-expense);
        }

        .stat-card.balance .stat-label,
        .stat-card.balance .stat-val {
            color: var(--text-balance);
        }

        /* NAVIGATION */
        nav {
            background-color: var(--card-bg);
            border-bottom: 1px solid var(--border);
            padding: 0.5rem;
            display: flex;
            justify-content: center;
            gap: 5px;
            overflow-x: auto;
            flex-shrink: 0;
            z-index: 9;
        }

        nav::-webkit-scrollbar {
            display: none;
        }

        .nav-btn {
            background: none;
            border: none;
            padding: 0.5rem 0.8rem;
            font-weight: 600;
            color: var(--neutral);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
            flex: 1;
            white-space: nowrap;
            font-size: 0.85rem;
        }

        .nav-btn.active {
            background-color: rgba(243, 108, 33, 0.2);
            color: var(--primary);
            font-weight: 700;
            border: 1px solid rgba(243, 108, 33, 0.3);
            box-shadow: 0 2px 4px rgba(243, 108, 33, 0.15);
        }

        main {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            position: relative;
            padding-bottom: 100px;
        }

        .view {
            display: none;
            animation: fadeIn 0.3s ease;
            padding-bottom: 20px;
        }

        .view.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --------------------------------------------------
           HOME PAGE
           -------------------------------------------------- */
        .home-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .home-hero {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: #fff;
            padding: 2.5rem 1.5rem;
            border-radius: var(--radius-lg);
            text-align: center;
            box-shadow: 0 8px 20px rgba(243, 108, 33, 0.3);
            position: relative;
            overflow: hidden;
        }

        .home-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 60%);
            z-index: 0;
        }

        .home-logo-big {
            width: 80px;
            height: 80px;
            background: #fff;
            border-radius: 16px;
            padding: 10px;
            margin: 0 auto 1rem auto;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
        }

        .home-logo-big img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .home-title {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
            letter-spacing: -0.5px;
        }

        .home-subtitle {
            font-size: 1.1rem;
            font-weight: 500;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            margin-bottom: 1.5rem;
        }

        .home-desc {
            font-size: 0.95rem;
            line-height: 1.6;
            opacity: 0.9;
            position: relative;
            z-index: 1;
            max-width: 80%;
            margin: 0 auto;
        }

        .features-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .feature-poster {
            background: var(--card-bg);
            border: 1px solid var(--border);
            padding: 1.5rem 1rem;
            border-radius: var(--radius-md);
            text-align: center;
            box-shadow: var(--shadow-sm);
            transition: transform 0.2s;
        }

        .feature-poster:active {
            transform: scale(0.98);
        }

        .feature-icon-lg {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .feature-poster h4 {
            color: var(--text-color);
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .feature-poster p {
            color: var(--neutral);
            font-size: 0.75rem;
            line-height: 1.3;
            margin: 0;
        }

        .home-credits {
            text-align: center;
            margin-top: 2rem;
            padding: 1rem;
            background: var(--card-bg);
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
        }

        .home-credits h3 {
            color: var(--primary);
            font-size: 1rem;
            margin-bottom: 0.2rem;
        }

        .home-credits p {
            color: var(--neutral);
            font-size: 0.75rem;
            margin: 0;
        }

        .home-credits a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        /* --------------------------------------------------
           FORM STYLES
           -------------------------------------------------- */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius-md);
            padding: 1.25rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            color: var(--neutral);
            font-weight: 500;
            word-break: break-word;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-family: inherit;
            background-color: var(--input-bg);
            color: var(--text-color);
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(243, 108, 33, 0.2);
        }

        .form-control.error {
            border-color: #dc3545;
            background-color: rgba(220, 53, 69, 0.1);
        }

        .form-control:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: var(--light-bg);
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            color: var(--primary);
            opacity: 1;
        }

        .radio-group,
        .checkbox-wrapper {
            display: flex;
            gap: 15px;
            align-items: center;
            padding: 10px;
            background: var(--light-bg);
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            flex-wrap: wrap;
        }

        .radio-group label,
        .checkbox-wrapper label {
            margin: 0;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        #paidOptions .checkbox-wrapper {
            flex-wrap: nowrap !important;
            padding: 8px;
            background: transparent;
            border: none;
        }

        #paidOptions .checkbox-wrapper input {
            width: 20px;
            height: 20px;
            cursor: pointer;
            margin: 0;
        }

        #paidOptions .checkbox-wrapper label {
            width: auto;
            cursor: pointer;
        }

        .checkbox-wrapper {
            cursor: pointer;
        }

        .checkbox-wrapper label {
            cursor: pointer;
            width: 100%;
        }

        .denom-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 0.8rem;
            margin-top: 1rem;
        }

        .denom-item {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 0.5rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .denom-label {
            font-weight: 600;
            color: var(--neutral);
            font-size: 0.85rem;
        }

        .denom-input {
            width: 100%;
            padding: 4px;
            text-align: center;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-family: 'Roboto Mono', monospace;
            background-color: var(--input-bg);
            color: var(--text-color);
        }

        .denom-subtotal {
            font-size: 0.7rem;
            color: var(--primary);
            font-weight: 500;
        }

        .total-display {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: #fff;
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            text-align: center;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-md);
        }

        .total-label {
            font-size: 0.9rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .total-amount {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 0.5rem 0;
            font-family: 'Roboto Mono', monospace;
            word-break: break-word;
        }

        .total-words {
            font-style: italic;
            opacity: 0.9;
            font-size: 0.9rem;
            word-break: break-word;
        }

        .btn {
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 1rem;
            transition: var(--transition);
            width: 100%;
            white-space: nowrap;
        }

        .btn-primary {
            background-color: var(--primary);
            color: #fff;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background-color: var(--neutral);
            color: #fff;
        }

        .btn-success {
            background-color: #2e7d32;
            color: #fff;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--neutral);
            color: var(--neutral);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 1rem;
        }

        .modal.open {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 420px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            color: var(--text-color);
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--neutral);
        }

        .history-list {
            list-style: none;
        }

        .history-item {
            background: var(--card-bg);
            border-bottom: 1px solid var(--border);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: relative;
        }

        .h-left {
            flex: 1;
            padding-right: 15px;
            min-width: 0;
        }

        .h-name {
            font-weight: 700;
            font-size: 1.05rem;
            color: var(--secondary);
            margin-bottom: 4px;
            display: block;
            word-break: break-word;
            line-height: 1.3;
        }

        .h-details {
            display: flex;
            flex-direction: column;
            gap: 3px;
            font-size: 0.8rem;
            color: var(--history-text);
            font-weight: 500;
        }

        .h-detail-row {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .h-detail-row span {
            line-height: 1.2;
            word-break: break-word;
        }

        .badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            margin-right: 5px;
            white-space: nowrap;
        }

        .badge.due {
            background-color: #ffe0b2;
            color: #e65100;
        }

        .badge.expense {
            background-color: #ffcdd2;
            color: #c62828;
        }

        .badge.receivable {
            background-color: #e8f5e9;
            color: #2e7d32;
        }

        [data-theme="dark"] .badge.due {
            background-color: #5d4037;
            color: #ffcc80;
        }

        [data-theme="dark"] .badge.expense {
            background-color: #5c2b2b;
            color: #ef9a9a;
        }

        .h-right {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: flex-start;
            min-width: 80px;
            margin-left: 10px;
        }

        .h-amount {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 2px;
            white-space: nowrap;
        }

        .amount-income {
            color: var(--primary);
        }

        .amount-expense {
            color: var(--text-expense);
        }

        .h-words {
            font-size: 0.7rem;
            font-style: italic;
            color: var(--history-text);
            text-align: right;
            margin-bottom: 4px;
            line-height: 1.1;
            width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .menu-container {
            position: relative;
            display: inline-block;
            margin-top: auto;
            flex-shrink: 0;
        }

        .btn-menu {
            background: none;
            border: none;
            color: var(--history-text);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }

        .btn-menu:hover {
            color: var(--primary);
        }

        .item-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background: var(--card-bg);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-md);
            border-radius: var(--radius-sm);
            z-index: 200;
            min-width: 160px;
            overflow: hidden;
            pointer-events: none;
        }

        .item-menu.show {
            display: block;
            pointer-events: auto;
        }

        .menu-opt {
            display: block;
            width: 100%;
            padding: 10px 15px;
            text-align: left;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text-color);
            transition: background 0.2s;
            white-space: nowrap;
        }

        .menu-opt:hover {
            background-color: var(--light-bg);
        }

        .menu-opt.delete {
            color: #dc3545;
            border-top: 1px solid var(--border);
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            border-bottom: 1px dashed var(--border);
            padding-bottom: 4px;
            font-size: 0.9rem;
        }

        .detail-row span:last-child {
            font-weight: 600;
            font-family: 'Roboto Mono', monospace;
            word-break: break-word;
            text-align: right;
        }

        .denom-breakdown {
            margin-top: 1rem;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 10px;
            background: var(--light-bg);
        }

        .denom-br-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            font-size: 0.85rem;
        }

        [data-theme="dark"] .denom-br-row {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: var(--secondary);
            color: var(--card-bg);
            text-align: center;
            border-radius: var(--radius-md);
            padding: 16px;
            position: fixed;
            z-index: 2000;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            box-shadow: var(--shadow-md);
            width: max-content;
            max-width: 90%;
        }

        [data-theme="dark"] #toast {
            background-color: #F5F5F5;
            color: #121212;
        }

        #toast.show {
            visibility: visible;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @keyframes fadein {
            from {
                bottom: 0;
                opacity: 0;
            }

            to {
                bottom: 30px;
                opacity: 1;
            }
        }

        @keyframes fadeout {
            from {
                bottom: 30px;
                opacity: 1;
            }

            to {
                bottom: 0;
                opacity: 0;
            }
        }

        /* PWA INSTALL BANNER */
        #pwa-install-banner {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--primary);
            color: #fff;
            padding: 1rem;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }

            to {
                transform: translateY(0);
            }
        }

        .pwa-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .pwa-title {
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 2px;
        }

        .pwa-desc {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .btn-install {
            background-color: #fff;
            color: var(--primary);
            border: none;
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            font-size: 0.9rem;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .btn-close-pwa {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }

        .filter-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .filter-tabs {
            display: flex;
            background: var(--light-bg);
            padding: 4px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
        }

        .filter-tabs input[type="radio"] {
            display: none;
        }

        .filter-tabs label {
            flex: 1;
            text-align: center;
            padding: 8px 5px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--neutral);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .filter-tabs input[type="radio"]:checked+label {
            background-color: var(--card-bg);
            color: var(--primary);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .filter-input-wrapper {
            width: 100%;
        }

        .filter-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--input-bg);
            color: var(--text-color);
            font-family: inherit;
        }

        .custom-select-wrapper {
            position: relative;
            user-select: none;
            width: 100%;
        }

        .custom-select {
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .custom-select__trigger {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            font-size: 1rem;
            font-weight: 400;
            color: var(--text-color);
            background: var(--input-bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
        }

        .custom-select__trigger:hover {
            border-color: var(--primary);
        }

        .custom-select.open .custom-select__trigger {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(243, 108, 33, 0.2);
        }

        .custom-select__options {
            position: absolute;
            display: block;
            top: 100%;
            left: 0;
            right: 0;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--card-bg);
            box-shadow: var(--shadow-md);
            transition: all 0.3s;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            z-index: 50;
            max-height: 250px;
            overflow-y: auto;
            margin-top: 5px;
        }

        .custom-select.open .custom-select__options {
            opacity: 1;
            visibility: visible;
            pointer-events: all;
        }

        .custom-select__search {
            padding: 10px;
            border-bottom: 1px solid var(--border);
            background: var(--card-bg);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .custom-select__search input {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background: var(--input-bg);
            color: var(--text-color);
        }

        .custom-option {
            position: relative;
            display: block;
            padding: 0.75rem 1rem;
            font-size: 0.9rem;
            font-weight: 400;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            word-break: break-word;
        }

        [data-theme="dark"] .custom-option {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .custom-option:hover {
            background-color: rgba(243, 108, 33, 0.1);
            color: var(--primary);
        }

        .custom-option.selected {
            background-color: var(--primary);
            color: #fff;
        }

        .arrow {
            position: relative;
            height: 10px;
            width: 10px;
        }

        .arrow::before,
        .arrow::after {
            content: "";
            position: absolute;
            bottom: 0px;
            width: 0.15rem;
            height: 100%;
            transition: all 0.3s;
        }

        .arrow::before {
            left: -3px;
            transform: rotate(-45deg);
            background-color: var(--neutral);
        }

        .arrow::after {
            left: 3px;
            transform: rotate(45deg);
            background-color: var(--neutral);
        }

        .open .arrow::before {
            left: -3px;
            transform: rotate(45deg);
        }

        .open .arrow::after {
            left: 3px;
            transform: rotate(-45deg);
        }

        .search-hint {
            font-size: 0.75rem;
            color: var(--neutral);
            margin-top: 5px;
            font-style: italic;
        }

        .credits-container {
            text-align: center;
            margin-top: 1.5rem;
            padding-top: 0.5rem;
        }

        .credits-container h3 {
            color: var(--primary);
            font-size: 1.1rem;
            margin-bottom: 0.2rem;
        }

        .credits-container p {
            font-size: 0.9rem;
            color: var(--neutral);
            margin: 0.2rem 0;
        }

        .credits-container a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        /* --------------------------------------------------
           PROFESSIONAL PDF STYLES
           -------------------------------------------------- */
        .pdf-paper {
            font-family: 'Helvetica', 'Arial', sans-serif;
            color: #000;
            background: #fff;
            padding: 20px;
            width: 100%;
            max-width: 1000px;
            /* Wider for reports */
            margin: 0 auto;
            box-sizing: border-box;
            line-height: 1.3;
            position: relative;
        }

        /* Header */
        .pdf-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            border-bottom: 2px solid #F36C21;
            padding-bottom: 15px;
        }

        .pdf-brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .pdf-logo {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }

        .pdf-brand-text h1 {
            font-size: 18pt;
            color: #F36C21;
            margin: 0;
            line-height: 1.1;
            font-weight: 700;
        }

        .pdf-brand-text p {
            margin: 4px 0 0 0;
            font-size: 9pt;
            color: #666;
            font-style: italic;
        }

        .pdf-title-block {
            text-align: right;
        }

        .pdf-main-title {
            font-size: 16pt;
            font-weight: 800;
            text-transform: uppercase;
            color: #333;
            margin: 0 0 10px 0;
            letter-spacing: 0.5px;
        }

        .pdf-date-info {
            font-size: 9pt;
            color: #555;
            line-height: 1.4;
        }

        .pdf-date-info span {
            display: block;
            font-weight: 500;
        }

        /* Table */
        .pdf-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 9pt;
            border: 1px solid #ccc;
        }

        .pdf-table th {
            background-color: #F36C21;
            color: #fff;
            padding: 8px 6px;
            text-align: left;
            font-weight: 600;
            border: 1px solid #F36C21;
            font-size: 9pt;
        }

        .pdf-table td {
            padding: 6px;
            border: 1px solid #ddd;
            vertical-align: middle;
            word-wrap: break-word;
        }

        .text-right {
            text-align: right !important;
        }

        .text-center {
            text-align: center !important;
        }

        /* Row Colors */
        .row-green {
            background-color: #e8f5e9;
            /* Light Green */
        }

        .row-orange {
            background-color: #fff3e0;
            /* Light Orange */
        }

        .row-red {
            background-color: #ffebee;
            /* Light Red */
        }

        .status-paid {
            color: #2e7d32;
            font-weight: bold;
        }

        .status-due-rec {
            color: #c62828;
            font-weight: bold;
        }

        .status-due-pay {
            color: #e65100;
            font-weight: bold;
        }

        /* Summary Section */
        .pdf-summary {
            border: 1px solid #333;
            background-color: #fcfcfc;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .summary-title {
            font-size: 11pt;
            font-weight: 700;
            margin-bottom: 10px;
            text-transform: uppercase;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            color: #333;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            font-size: 10pt;
            border-bottom: 1px dotted #ccc;
            padding-bottom: 2px;
            margin-bottom: 5px;
        }

        .summary-item.total-balance {
            border-bottom: none;
            border-top: 2px solid #333;
            padding-top: 5px;
            font-weight: 700;
            font-size: 11pt;
            color: #F36C21;
        }

        .summary-label {
            font-weight: 500;
            color: #555;
        }

        .summary-val {
            font-family: 'Roboto Mono', monospace;
            font-weight: 600;
        }

        /* Footer */
        .pdf-footer {
            margin-top: 30px;
            padding-top: 10px;
            border-top: 1px solid #eee;
            font-size: 8pt;
            color: #777;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .empty-state-msg {
            text-align: center;
            padding: 50px 20px;
            color: #666;
            font-size: 14pt;
            font-style: italic;
            border: 2px dashed #ddd;
            margin: 50px 20px;
        }

        @media print {

            body,
            #app-container {
                display: none !important;
            }

            #pdf-render-container {
                position: static;
                left: auto;
                top: auto;
                width: 100%;
                display: block;
                padding: 0;
                opacity: 1;
                z-index: 9999;
                background: white;
            }

            .pdf-paper {
                padding: 10px;
                width: 100%;
                max-width: none;
                margin: 0;
            }
        }
    </style>
</head>

<body data-theme="light">

    <!-- Hidden Container for PDF Generation -->
    <div id="pdf-render-container"></div>

    <div id="app-container">
        <header>
            <div class="brand">
                <div class="brand-top">
                    <div class="brand-icon">
                        <img src="icon.png" alt="ArthaNex Logo">
                    </div>
                    <div>
                        <h1>ArthaNex</h1>
                    </div>
                </div>
                <a href="https://arthixa.com" target="_blank">by Arthixa</a>
            </div>
            <div class="header-actions">
                <button id="settingsBtn" aria-label="Settings">âš™</button>
            </div>
        </header>

        <div class="dashboard-container">
            <div class="stat-card income">
                <div class="stat-label">Income</div>
                <div class="stat-val" id="dashIncome">0</div>
            </div>
            <div class="stat-card expense">
                <div class="stat-label">Expenses</div>
                <div class="stat-val" id="dashExpense">0</div>
            </div>
            <div class="stat-card balance">
                <div class="stat-label">Balance</div>
                <div class="stat-val" id="dashBalance">0</div>
            </div>
        </div>

        <!-- NAVIGATION -->
        <nav>
            <button class="nav-btn" onclick="app.switchTab('home')">Home</button>
            <button class="nav-btn" onclick="app.switchTab('entry')">Entry</button>
            <button class="nav-btn" onclick="app.switchTab('history')">History</button>
            <button class="nav-btn" onclick="app.switchTab('outstanding')">Dues</button>
            <button class="nav-btn" onclick="app.switchTab('ledger')">Ledger</button>
        </nav>
        <main>
            <!-- HOME SECTION -->
            <section id="home" class="view active">
                <div class="home-container">

                    <div class="home-hero">
                        <div class="home-logo-big">
                            <img src="icon.png" alt="ArthaNex">
                        </div>
                        <h2 class="home-title">ArthaNex</h2>
                        <div class="home-subtitle">Best Offline Khata Book</div>
                        <p class="home-desc">The ultimate Offline Khata Book & Daily Cash Collection App for small
                            businesses. Track Income & Expenses, manage Party Ledger & Dues without internet. Best
                            Billing & Collection Tracker for local shops.</p>

                        <p
                            style="font-size: 0.85rem; font-weight: 600; background: rgba(255,255,255,0.2); display: inline-block; padding: 4px 12px; border-radius: 20px; margin-top: 15px; position: relative; z-index: 1;">
                            ðŸŒ Supports 50+ Countries & Currencies
                        </p>
                    </div>

                    <div class="features-grid">
                        <div class="feature-poster">
                            <span class="feature-icon-lg">ðŸ“±</span>
                            <h4>Offline Khata Book</h4>
                            <p>Track Cash & Expenses 100% Offline.</p>
                        </div>
                        <div class="feature-poster">
                            <span class="feature-icon-lg">ðŸ’°</span>
                            <h4>Denomination Calculator</h4>
                            <p>Fast Cash Counting & Tally Tool.</p>
                        </div>
                        <div class="feature-poster">
                            <span class="feature-icon-lg">ðŸ“Š</span>
                            <h4>Party Ledger Manager</h4>
                            <p>Customer Accounts & Credit/Debit.</p>
                        </div>
                        <div class="feature-poster">
                            <span class="feature-icon-lg">ðŸ”’</span>
                            <h4>Secure Data Privacy</h4>
                            <p>Data stored locally on your device.</p>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="app.switchTab('entry')"
                        style="margin-top: 1rem; font-size: 1.1rem; padding: 1rem;">
                        âž• Start New Entry
                    </button>

                    <div class="home-credits">
                        <h3>ArthaNex v2.0.4</h3>
                        <p>Author: Pintu Sikder</p>
                        <p>Company: <a href="https://arthixa.com" target="_blank">Arthixa</a></p>
                    </div>
                </div>
            </section>

            <!-- SECTION 1: CASH ENTRY -->
            <section id="entry" class="view">
                <div class="card">
                    <div class="form-group">
                        <label>Country & Currency</label>
                        <div class="custom-select-wrapper">
                            <div class="custom-select" id="countryDropdown">
                                <div class="custom-select__trigger"><span>Select Country</span>
                                    <div class="arrow"></div>
                                </div>
                                <div class="custom-select__options">
                                    <div class="custom-select__search">
                                        <input type="text" placeholder="Ex: India, USD, Euro..."
                                            id="countrySearchInput">
                                    </div>
                                    <div
                                        style="padding: 0 10px 10px 10px; font-size: 0.75rem; color: var(--neutral); font-style: italic;">
                                        Try typing country name (e.g., "India") or Currency Code (e.g., "USD").
                                    </div>
                                    <div class="options-container" id="countryOptionsList"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group" style="display: flex; gap: 10px;">
                        <div style="flex:1">
                            <label>Date</label>
                            <input type="date" id="entryDate" class="form-control">
                        </div>
                        <div style="flex:1">
                            <label>Time</label>
                            <input type="time" id="entryTime" class="form-control">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Collected By (Name) *</label>
                        <input type="text" id="entryName" class="form-control" placeholder="Enter Name (Required)">
                    </div>

                    <div class="form-group">
                        <label>Mobile Number</label>
                        <input type="tel" id="entryMobile" class="form-control" placeholder="Optional">
                    </div>

                    <div class="form-group">
                        <label>Remarks / Notes</label>
                        <input type="text" id="entryRemarks" class="form-control" placeholder="Optional notes...">
                    </div>

                    <div class="form-group">
                        <label>Payment Status</label>
                        <select id="entryStatus" class="form-control" onchange="app.handleStatusChange()">
                            <option value="Paid">Paid (Cleared)</option>
                            <option value="Due">Due (Outstanding)</option>
                        </select>
                    </div>

                    <div class="form-group" id="paidOptions">
                        <div class="checkbox-wrapper" onclick="app.togglePayable()">
                            <input type="checkbox" id="entryPayable">
                            <label for="entryPayable">Payable to Customer (Cash Out)</label>
                        </div>
                    </div>

                    <div class="form-group" id="dueOptions" style="display: none;">
                        <label>Due Type (Who owes whom?)</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="dueType" value="receivable" checked>
                                Receivable (Customer will pay)
                            </label>
                            <label>
                                <input type="radio" name="dueType" value="payable">
                                Payable (I have to pay)
                            </label>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <label style="font-weight: 600; color: var(--neutral);">Denomination Counter</label>
                    <div id="denominationContainer" class="denom-grid"></div>
                </div>

                <div class="total-display">
                    <div class="total-label">Total Amount</div>
                    <div class="total-amount" id="displayTotal">0.00</div>
                    <div class="total-words" id="displayWords">Select a country to begin</div>
                </div>

                <div style="margin-bottom: 80px;">
                    <button class="btn btn-primary" onclick="app.saveRecord()">
                        <span>ðŸ’¾ Save Record</span>
                    </button>
                </div>
            </section>

            <!-- SECTION 2: HISTORY -->
            <section id="history" class="view">
                <div class="card">
                    <div class="filter-container">
                        <div class="filter-tabs">
                            <input type="radio" id="filter-name" name="filterType" value="name"
                                onchange="app.setFilterMode('name')" checked>
                            <label for="filter-name">Name</label>

                            <input type="radio" id="filter-date" name="filterType" value="date"
                                onchange="app.setFilterMode('date')">
                            <label for="filter-date">Date</label>

                            <input type="radio" id="filter-amount" name="filterType" value="amount"
                                onchange="app.setFilterMode('amount')">
                            <label for="filter-amount">Amount</label>
                        </div>

                        <div class="filter-input-wrapper">
                            <input type="text" id="filterName" class="filter-input"
                                placeholder="Search by Name (e.g. Rahul)..."
                                onkeyup="app.handleFilter('name', this.value)">
                            <input type="date" id="filterDate" class="filter-input" style="display:none;"
                                onchange="app.handleFilter('date', this.value)">
                            <input type="number" id="filterAmount" class="filter-input" placeholder="Enter Amount..."
                                style="display:none;" onkeyup="app.handleFilter('amount', this.value)">
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="btn btn-secondary" style="flex:1" onclick="app.exportLast30Days()">Export (30
                            Days)</button>
                        <button class="btn btn-outline" style="flex:1" onclick="app.openRangeModal()">Date
                            Range</button>
                    </div>
                </div>

                <ul id="historyList" class="history-list"></ul>
                <div id="emptyState" class="text-center" style="padding: 2rem; display: none;">
                    <p style="color: var(--neutral);">No records found.</p>
                </div>
            </section>

            <!-- SECTION 3: OUTSTANDING / DUES -->
            <section id="outstanding" class="view">
                <div class="card">
                    <h3 style="margin-bottom: 15px; color: var(--primary);">Outstanding Summary</h3>
                    <div class="dashboard-container"
                        style="margin-bottom: 10px; padding:0; border:none; background:transparent; grid-template-columns: 1fr 1fr;">
                        <div class="stat-card">
                            <div class="stat-label">To Receive</div>
                            <div class="stat-val" style="color:var(--text-income)" id="dueReceivable">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">To Pay</div>
                            <div class="stat-val" style="color:var(--text-expense)" id="duePayable">0</div>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 10px; display:flex; gap:10px;">
                    <button class="btn btn-outline" onclick="app.renderOutstanding('all')">All</button>
                    <button class="btn btn-outline" style="border-color:var(--text-income); color:var(--text-income)"
                        onclick="app.renderOutstanding('receivable')">Receivable</button>
                    <button class="btn btn-outline" style="border-color:var(--text-expense); color:var(--text-expense)"
                        onclick="app.renderOutstanding('payable')">Payable</button>
                </div>

                <ul id="outstandingList" class="history-list"></ul>
                <div id="outstandingEmpty" class="text-center" style="padding: 2rem; display: none;">
                    <p style="color: var(--neutral);">No outstanding dues.</p>
                </div>
            </section>

            <!-- SECTION 4: PARTY LEDGER -->
            <section id="ledger" class="view">
                <div class="card">
                    <label>Search Customer / Party</label>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="ledgerSearch" class="form-control" placeholder="Ex: Rahul, Priya..."
                            oninput="app.suggestLedgerName(this.value)">
                    </div>
                    <div id="ledgerSuggestions" style="margin-top:5px; display:flex; flex-wrap:wrap; gap:5px;"></div>
                    <div class="search-hint">Type customer name to see their ledger.</div>
                </div>

                <div id="ledgerDetails" style="display:none;">
                    <div class="card">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <h3 id="ledgerCustomerName" style="color:var(--primary); margin:0; word-break: break-word;">
                                Customer Name</h3>
                            <button class="btn btn-outline" style="width:auto; padding:5px 10px; font-size:0.8rem;"
                                onclick="app.clearLedger()">Clear</button>
                        </div>

                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:15px;">
                            <div
                                style="background:var(--bg-income); padding:10px; border-radius:var(--radius-sm); text-align:center;">
                                <div style="font-size:0.7rem; text-transform:uppercase;">Total Received</div>
                                <div style="font-size:1.1rem; font-weight:bold; color:var(--text-income);"
                                    id="ledgerTotalReceived">0</div>
                            </div>
                            <div
                                style="background:var(--bg-expense); padding:10px; border-radius:var(--radius-sm); text-align:center;">
                                <div style="font-size:0.7rem; text-transform:uppercase;">Total Paid/Given</div>
                                <div style="font-size:1.1rem; font-weight:bold; color:var(--text-expense);"
                                    id="ledgerTotalPaid">0</div>
                            </div>
                        </div>

                        <div
                            style="margin-top:10px; padding:10px; background:var(--bg-balance); border-radius:var(--radius-sm); text-align:center;">
                            <div style="font-size:0.7rem; text-transform:uppercase;">Net Balance</div>
                            <div style="font-size:1.2rem; font-weight:bold; color:var(--text-balance);"
                                id="ledgerNetBalance">0</div>
                        </div>
                    </div>

                    <h4 style="margin: 20px 0 10px 5px; font-size:1rem; color:var(--neutral);">Transactions</h4>
                    <ul id="ledgerList" class="history-list"></ul>
                </div>
                <div id="ledgerEmpty" class="text-center" style="padding: 2rem; margin-top:20px; display: block;">
                    <p style="color: var(--neutral);">Select a customer to view ledger.</p>
                </div>
            </section>
        </main>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal">
            <div class="modal-content">
                <button class="modal-close" onclick="app.toggleModal('settingsModal')">&times;</button>
                <h2 style="margin-bottom: 1.5rem; color: var(--primary);">Settings</h2>
                <div class="form-group">
                    <label>Theme</label>
                    <select id="themeSelect" class="form-control" onchange="app.setTheme(this.value)">
                        <option value="light">Light Mode</option>
                        <option value="dark">Dark Mode</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Country & Currency</label>
                    <div class="custom-select-wrapper">
                        <div class="custom-select" id="settingsCountryDropdown">
                            <div class="custom-select__trigger"><span>Select Country</span>
                                <div class="arrow"></div>
                            </div>
                            <div class="custom-select__options">
                                <div class="custom-select__search">
                                    <input type="text" placeholder="Ex: India, USD, Euro..." id="settingsSearchInput">
                                </div>
                                <div
                                    style="padding: 0 10px 10px 10px; font-size: 0.75rem; color: var(--neutral); font-style: italic;">
                                    Try typing country name or Currency Code.
                                </div>
                                <div class="options-container" id="settingsOptionsList"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="checkbox-wrapper"
                        style="display: flex; align-items: center; gap: 10px; padding: 5px 0; border: none; background: transparent;"
                        onclick="app.toggleAutoDelete()">
                        <input type="checkbox" id="autoDeleteToggle" style="cursor: pointer;">
                        <label for="autoDeleteToggle" style="cursor: pointer; width: auto;">Auto-delete records older
                            than 90 days</label>
                    </div>
                    <div style="font-size: 0.75rem; color: var(--neutral); margin-top: 5px; margin-left: 24px;">When
                        enabled, records older than 90 days are automatically deleted on app reload.</div>
                </div>

                <hr style="margin: 1.5rem 0; border: 0; border-top: 1px solid var(--border);">
                <div class="credits-container">
                    <h3>ArthaNex</h3>
                    <p>Version 2.0.4</p>
                    <p>Author: Pintu Sikder</p>
                    <p>Company: <a href="https://arthixa.com" target="_blank" class="company-link">Arthixa</a></p>
                </div>
            </div>
        </div>

        <!-- Date Range Modal -->
        <div id="dateRangeModal" class="modal">
            <div class="modal-content">
                <button class="modal-close" onclick="app.toggleModal('dateRangeModal')">&times;</button>
                <h2 style="margin-bottom: 1.5rem; color: var(--primary);">Select Date Range</h2>
                <div class="form-group"><label>From Date</label><input type="date" id="rangeStart" class="form-control">
                </div>
                <div class="form-group"><label>To Date</label><input type="date" id="rangeEnd" class="form-control">
                </div>
                <button class="btn btn-primary" onclick="app.executeRangeExport()">Export Range</button>
            </div>
        </div>

        <!-- View Details Modal -->
        <div id="viewDetailModal" class="modal">
            <div class="modal-content">
                <button class="modal-close" onclick="app.toggleModal('viewDetailModal')">&times;</button>
                <h2 style="margin-bottom: 1rem; color: var(--primary);">Record Details</h2>
                <div id="detailContent"></div>
            </div>
        </div>

        <div id="toast">Message here</div>

        <!-- PWA INSTALL BANNER UI -->
        <div id="pwa-install-banner">
            <div class="pwa-content">
                <div class="pwa-title">Install as App</div>
                <div class="pwa-desc">Add to Home Screen for quick access</div>
            </div>
            <button id="installBtn" class="btn-install">Install</button>
            <button id="closePrompt" class="btn-close-pwa">&times;</button>
        </div>

    </div>

    <script>
        // PWA Install Prompt Logic
        let deferredPrompt;
        const installBanner = document.getElementById('pwa-install-banner');
        const installBtn = document.getElementById('installBtn');
        const closePrompt = document.getElementById('closePrompt');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBanner.style.display = 'flex';
        });

        installBtn.addEventListener('click', (e) => {
            installBanner.style.display = 'none';
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted A2HS prompt');
                    }
                    deferredPrompt = null;
                });
            }
        });

        closePrompt.addEventListener('click', () => {
            installBanner.style.display = 'none';
            deferredPrompt = null;
        });

        // App Logic
        const app = {
            state: {
                currentTheme: 'light',
                base64Icon: "data:image/png;base64,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", // Placeholder
                autoDeleteEnabled: true,
                config: [
                    { name: "United States", currency: "USD", symbol: "$", denominations: [1, 2, 5, 10, 20, 50, 100] },
                    { name: "India", currency: "INR", symbol: "â‚¹", denominations: [1, 2, 5, 10, 20, 50, 100, 200, 500] },
                    { name: "Euro Zone", currency: "EUR", symbol: "â‚¬", denominations: [5, 10, 20, 50, 100, 200, 500] },
                    { name: "United Kingdom", currency: "GBP", symbol: "Â£", denominations: [5, 10, 20, 50] },
                    { name: "Japan", currency: "JPY", symbol: "Â¥", denominations: [1, 5, 10, 50, 100, 500, 1000, 5000, 10000] },
                    { name: "Australia", currency: "AUD", symbol: "A$", denominations: [5, 10, 20, 50, 100] },
                    { name: "Canada", currency: "CAD", symbol: "C$", denominations: [5, 10, 20, 50, 100] },
                    { name: "China", currency: "CNY", symbol: "Â¥", denominations: [1, 5, 10, 20, 50, 100] },
                    { name: "Switzerland", currency: "CHF", symbol: "Fr", denominations: [10, 20, 50, 100, 200, 1000] },
                    { name: "Russia", currency: "RUB", symbol: "â‚½", denominations: [50, 100, 200, 500, 1000, 2000, 5000] },
                    { name: "South Korea", currency: "KRW", symbol: "â‚©", denominations: [1000, 5000, 10000, 50000] },
                    { name: "Brazil", currency: "BRL", symbol: "R$", denominations: [10, 20, 50, 100, 200] },
                    { name: "Mexico", currency: "MXN", symbol: "$", denominations: [20, 50, 100, 200, 500] },
                    { name: "South Africa", currency: "ZAR", symbol: "R", denominations: [10, 20, 50, 100, 200] },
                    { name: "Singapore", currency: "SGD", symbol: "S$", denominations: [2, 5, 10, 50, 100, 1000] },
                    { name: "Hong Kong", currency: "HKD", symbol: "HK$", denominations: [10, 20, 50, 100, 500, 1000] },
                    { name: "New Zealand", currency: "NZD", symbol: "NZ$", denominations: [5, 10, 20, 50, 100] },
                    { name: "Sweden", currency: "SEK", symbol: "kr", denominations: [20, 50, 100, 200, 500] },
                    { name: "Norway", currency: "NOK", symbol: "kr", denominations: [50, 100, 200, 500, 1000] },
                    { name: "Denmark", currency: "DKK", symbol: "kr", denominations: [50, 100, 200, 500, 1000] },
                    { name: "Poland", currency: "PLN", symbol: "zÅ‚", denominations: [10, 20, 50, 100, 200, 500] },
                    { name: "Turkey", currency: "TRY", symbol: "â‚º", denominations: [20, 50, 100, 200, 500] },
                    { name: "Thailand", currency: "THB", symbol: "à¸¿", denominations: [20, 50, 100, 500, 1000] },
                    { name: "Malaysia", currency: "MYR", symbol: "RM", denominations: [1, 5, 10, 20, 50, 100] },
                    { name: "Indonesia", currency: "IDR", symbol: "Rp", denominations: [1000, 2000, 5000, 10000, 20000, 50000, 100000] },
                    { name: "Philippines", currency: "PHP", symbol: "â‚±", denominations: [20, 50, 100, 200, 500, 1000] },
                    { name: "Vietnam", currency: "VND", symbol: "â‚«", denominations: [1000, 2000, 5000, 10000, 20000, 50000, 100000, 200000, 500000] },
                    { name: "UAE", currency: "AED", symbol: "dh", denominations: [5, 10, 20, 50, 100, 200, 500, 1000] },
                    { name: "Saudi Arabia", currency: "SAR", symbol: "ï·¼", denominations: [1, 5, 10, 50, 100, 200, 500] },
                    { name: "Israel", currency: "ILS", symbol: "â‚ª", denominations: [20, 50, 100, 200] },
                    { name: "Czech Republic", currency: "CZK", symbol: "KÄ", denominations: [100, 200, 500, 1000, 2000, 5000] },
                    { name: "Hungary", currency: "HUF", symbol: "Ft", denominations: [500, 1000, 2000, 5000, 10000, 20000] },
                    { name: "Romania", currency: "RON", symbol: "lei", denominations: [1, 5, 10, 20, 50, 100, 200, 500] },
                    { name: "Bulgaria", currency: "BGN", symbol: "Ð»Ð²", denominations: [10, 20, 50, 100] },
                    { name: "Croatia", currency: "EUR", symbol: "â‚¬", denominations: [5, 10, 20, 50, 100, 200, 500] },
                    { name: "Nigeria", currency: "NGN", symbol: "â‚¦", denominations: [5, 10, 20, 50, 100, 200, 500, 1000] },
                    { name: "Egypt", currency: "EGP", symbol: "EÂ£", denominations: [10, 20, 50, 100, 200, 500] },
                    { name: "Pakistan", currency: "PKR", symbol: "â‚¨", denominations: [10, 20, 50, 100, 500, 1000, 5000] },
                    { name: "Bangladesh", currency: "BDT", symbol: "à§³", denominations: [10, 20, 50, 100, 200, 500, 1000] },
                    { name: "Sri Lanka", currency: "LKR", symbol: "Rs", denominations: [20, 50, 100, 200, 500, 1000, 2000, 5000] },
                    { name: "Nepal", currency: "NPR", symbol: "â‚¨", denominations: [5, 10, 20, 50, 100, 500, 1000] },
                    { name: "Myanmar", currency: "MMK", symbol: "K", denominations: [50, 100, 200, 500, 1000, 5000, 10000] },
                    { name: "Argentina", currency: "ARS", symbol: "$", denominations: [100, 200, 500, 1000, 2000, 5000, 10000] },
                    { name: "Chile", currency: "CLP", symbol: "$", denominations: [1000, 2000, 5000, 10000, 20000] },
                    { name: "Colombia", currency: "COP", symbol: "$", denominations: [2000, 5000, 10000, 20000, 50000, 100000] },
                    { name: "Peru", currency: "PEN", symbol: "S/", denominations: [10, 20, 50, 100, 200] },
                    { name: "Venezuela", currency: "VES", symbol: "Bs.", denominations: [5, 10, 20, 50, 100] },
                    { name: "Iraq", currency: "IQD", symbol: "Ø¹.Ø¯", denominations: [250, 500, 1000, 5000, 10000, 25000] },
                    { name: "Kuwait", currency: "KWD", symbol: "Ø¯.Ùƒ", denominations: [0.25, 0.5, 1, 5, 10, 20] }
                ],
                selectedCountry: null,
                records: [],
                denominations: {},
                filters: {
                    mode: 'name',
                    name: "",
                    date: "",
                    amount: ""
                }
            },

            init: function () {
                this.loadSettings();
                this.setupDropdown();
                this.setupSettingsDropdown();
                this.loadRecords();
                this.cleanupOldRecords();
                this.updateDashboard();

                const now = new Date();
                document.getElementById('entryDate').valueAsDate = now;
                document.getElementById('entryTime').value = now.toTimeString().substring(0, 5);

                const todayStr = now.toISOString().split('T')[0];
                document.getElementById('entryDate').max = todayStr;
                document.getElementById('filterDate').max = todayStr;
                document.getElementById('rangeStart').max = todayStr;
                document.getElementById('rangeEnd').max = todayStr;

                document.getElementById('settingsBtn').addEventListener('click', () => this.toggleModal('settingsModal'));

                window.addEventListener('click', (e) => {
                    if (!e.target.closest('.menu-container')) this.closeAllMenus();
                    if (e.target.classList.contains('modal')) e.target.classList.remove('open');
                });

                const savedCurrency = localStorage.getItem('arthaNex_lastCountry');
                if (savedCurrency) {
                    const foundCountry = this.state.config.find(c => c.currency === savedCurrency);
                    if (foundCountry) {
                        this.selectCountry(foundCountry);
                    }
                }

                this.switchTab('home');
            },

            togglePayable: function () {
                const cb = document.getElementById('entryPayable');
                if (cb) { cb.checked = !cb.checked; }
            },

            toggleAutoDelete: function () {
                const cb = document.getElementById('autoDeleteToggle');
                if (cb) {
                    cb.checked = !cb.checked;
                    this.state.autoDeleteEnabled = cb.checked;
                    localStorage.setItem('arthaNex_autoDelete', cb.checked);
                }
            },

            handleStatusChange: function () {
                const status = document.getElementById('entryStatus').value;
                const paidOpts = document.getElementById('paidOptions');
                const dueOpts = document.getElementById('dueOptions');

                if (status === 'Paid') {
                    paidOpts.style.display = 'block';
                    dueOpts.style.display = 'none';
                } else {
                    paidOpts.style.display = 'none';
                    dueOpts.style.display = 'block';
                }
            },

            updateDashboard: function () {
                const totalIncome = this.state.records.filter(r => r.type === 'income').reduce((sum, r) => sum + r.total, 0);
                const totalExpense = this.state.records.filter(r => r.type === 'expense').reduce((sum, r) => sum + r.total, 0);
                const netBalance = totalIncome - totalExpense;

                document.getElementById('dashIncome').textContent = totalIncome.toLocaleString();
                document.getElementById('dashExpense').textContent = totalExpense.toLocaleString();
                document.getElementById('dashBalance').textContent = netBalance.toLocaleString();

                const dueRec = this.state.records.filter(r => r.status === 'Due' && r.type === 'income').reduce((sum, r) => sum + r.total, 0);
                const duePay = this.state.records.filter(r => r.status === 'Due' && r.type === 'expense').reduce((sum, r) => sum + r.total, 0);
                document.getElementById('dueReceivable').textContent = dueRec.toLocaleString();
                document.getElementById('duePayable').textContent = duePay.toLocaleString();
            },

            setupDropdown: function () {
                const wrapper = document.querySelector('#countryDropdown');
                const trigger = wrapper.querySelector('.custom-select__trigger');
                const searchInput = document.getElementById('countrySearchInput');
                this.populateOptions(this.state.config, 'countryOptionsList');

                trigger.addEventListener('click', (e) => {
                    wrapper.classList.toggle('open');
                    if (wrapper.classList.contains('open')) {
                        searchInput.value = '';
                        searchInput.focus();
                        this.populateOptions(this.state.config, 'countryOptionsList');
                    }
                });

                searchInput.addEventListener('input', (e) => {
                    const term = e.target.value.toLowerCase();
                    const filtered = this.state.config.filter(c => {
                        const countryMatch = c.name.toLowerCase().includes(term);
                        const currencyMatch = c.currency.toLowerCase().includes(term);
                        return countryMatch || currencyMatch;
                    });
                    this.populateOptions(filtered, 'countryOptionsList');
                });

                window.addEventListener('click', (e) => {
                    if (!wrapper.contains(e.target)) wrapper.classList.remove('open');
                });
            },

            setupSettingsDropdown: function () {
                const wrapper = document.querySelector('#settingsCountryDropdown');
                const trigger = wrapper.querySelector('.custom-select__trigger');
                const searchInput = document.getElementById('settingsSearchInput');
                this.populateOptions(this.state.config, 'settingsOptionsList');

                trigger.addEventListener('click', (e) => {
                    wrapper.classList.toggle('open');
                    if (wrapper.classList.contains('open')) {
                        searchInput.value = '';
                        searchInput.focus();
                        this.populateOptions(this.state.config, 'settingsOptionsList');
                    }
                });

                searchInput.addEventListener('input', (e) => {
                    const term = e.target.value.toLowerCase();
                    const filtered = this.state.config.filter(c => {
                        const countryMatch = c.name.toLowerCase().includes(term);
                        const currencyMatch = c.currency.toLowerCase().includes(term);
                        return countryMatch || currencyMatch;
                    });
                    this.populateOptions(filtered, 'settingsOptionsList');
                });

                window.addEventListener('click', (e) => {
                    if (!wrapper.contains(e.target)) wrapper.classList.remove('open');
                });
            },

            populateOptions: function (list, targetId) {
                const container = document.getElementById(targetId);
                container.innerHTML = '';
                if (list.length === 0) {
                    container.innerHTML = '<div class="custom-option" style="cursor:default; color:var(--neutral)">No match found</div>';
                    return;
                }
                list.forEach(c => {
                    const el = document.createElement('span');
                    el.className = 'custom-option';
                    if (this.state.selectedCountry && this.state.selectedCountry.name === c.name) el.classList.add('selected');
                    el.textContent = `${c.name} (${c.currency})`;
                    el.addEventListener('click', () => {
                        this.selectCountry(c);
                        if (document.getElementById('settingsModal').classList.contains('open')) this.toggleModal('settingsModal');
                        document.querySelector('#settingsCountryDropdown').classList.remove('open');
                        document.querySelector('#countryDropdown').classList.remove('open');
                    });
                    container.appendChild(el);
                });
            },

            selectCountry: function (country) {
                this.state.selectedCountry = country;
                const entryTrigger = document.querySelector('#countryDropdown .custom-select__trigger span');
                if (entryTrigger) entryTrigger.textContent = `${country.name} (${country.currency})`;
                const settingsTrigger = document.querySelector('#settingsCountryDropdown .custom-select__trigger span');
                if (settingsTrigger) settingsTrigger.textContent = `${country.name} (${country.currency})`;
                localStorage.setItem('arthaNex_lastCountry', country.currency);
                document.querySelectorAll('.custom-option').forEach(opt => opt.classList.remove('selected'));
                this.loadDenominations();
            },

            setTheme: function (theme) {
                this.state.currentTheme = theme;
                document.body.setAttribute('data-theme', theme);
                document.documentElement.setAttribute('color-scheme', theme);
                document.getElementById('themeSelect').value = theme;
                localStorage.setItem('arthaNex_theme', theme);
            },
            loadSettings: function () {
                const savedTheme = localStorage.getItem('arthaNex_theme');
                if (savedTheme) this.setTheme(savedTheme);
                const autoDelete = localStorage.getItem('arthaNex_autoDelete');
                if (autoDelete !== null) {
                    this.state.autoDeleteEnabled = (autoDelete === 'true');
                    document.getElementById('autoDeleteToggle').checked = this.state.autoDeleteEnabled;
                }
            },
            toggleModal: function (id) {
                const modal = document.getElementById(id);
                modal.classList.toggle('open');
            },
            switchTab: function (id) {
                document.querySelectorAll('.view').forEach(e => e.classList.remove('active'));
                document.querySelectorAll('.nav-btn').forEach(e => e.classList.remove('active'));
                document.getElementById(id).classList.add('active');

                const btnIndex = ['home', 'entry', 'history', 'outstanding', 'ledger'].indexOf(id);
                if (btnIndex >= 0) document.querySelectorAll('.nav-btn')[btnIndex].classList.add('active');

                if (id === 'history') this.renderHistory();
                if (id === 'outstanding') {
                    this.updateDashboard();
                    this.renderOutstanding('all');
                }
            },

            loadDenominations: function () {
                const container = document.getElementById('denominationContainer');
                container.innerHTML = '';
                this.state.denominations = {};
                this.state.selectedCountry.denominations.forEach(denom => {
                    this.state.denominations[denom] = 0;
                    const item = document.createElement('div');
                    item.className = 'denom-item';
                    item.innerHTML = `
                        <label class="denom-label">${denom}</label>
                        <input type="number" class="denom-input" min="0" oninput="app.calculateTotal('${denom}', this.value)">
                        <span class="denom-subtotal" id="sub_${denom}">0</span>
                    `;
                    container.appendChild(item);
                });
                this.calculateTotal();
            },
            calculateTotal: function (denomChanged, val) {
                if (denomChanged) this.state.denominations[denomChanged] = parseFloat(val) || 0;
                let total = 0;
                this.state.selectedCountry.denominations.forEach(d => {
                    const count = this.state.denominations[d];
                    total += (count * d);
                    const subEl = document.getElementById(`sub_${d}`);
                    if (subEl) subEl.textContent = (count * d).toLocaleString();
                });
                const symbol = this.state.selectedCountry.symbol;
                document.getElementById('displayTotal').textContent = `${symbol} ${total.toLocaleString(undefined, { minimumFractionDigits: 2 })}`;
                document.getElementById('displayWords').textContent = this.numberToWords(total) + " " + this.state.selectedCountry.currency;
            },

            saveRecord: function () {
                if (!this.state.selectedCountry) {
                    this.showToast("Please select a country first in Settings.");
                    this.toggleModal('settingsModal');
                    return;
                }

                const nameInput = document.getElementById('entryName');
                const nameValue = nameInput.value.trim();
                if (nameValue === "") {
                    this.showToast("Please enter a Name (Mandatory Field).");
                    nameInput.classList.add('error');
                    nameInput.focus();
                    return;
                } else {
                    nameInput.classList.remove('error');
                }

                let hasEntries = false;
                let total = 0;
                Object.keys(this.state.denominations).forEach(k => {
                    const count = this.state.denominations[k];
                    total += (k * count);
                    if (count > 0) hasEntries = true;
                });
                if (!hasEntries) {
                    this.showToast("Denomination is Mandatory. Please enter at least one count.");
                    return;
                }

                const status = document.getElementById('entryStatus').value;
                let type = 'income';

                if (status === 'Paid') {
                    const isPayable = document.getElementById('entryPayable').checked;
                    type = isPayable ? 'expense' : 'income';
                } else {
                    const dueType = document.querySelector('input[name="dueType"]:checked').value;
                    type = (dueType === 'payable') ? 'expense' : 'income';
                }

                const record = {
                    id: Date.now(),
                    type: type,
                    status: status,
                    country: this.state.selectedCountry.name,
                    currency: this.state.selectedCountry.currency,
                    symbol: this.state.selectedCountry.symbol,
                    date: document.getElementById('entryDate').value,
                    time: document.getElementById('entryTime').value,
                    name: nameValue,
                    mobile: document.getElementById('entryMobile').value || "",
                    remarks: document.getElementById('entryRemarks').value || "",
                    denominations: { ...this.state.denominations },
                    total: total,
                    timestamp: Date.now()
                };

                this.state.records.push(record);
                localStorage.setItem('arthaNex_records', JSON.stringify(this.state.records));
                this.updateDashboard();
                this.showToast("Record Saved Successfully!");
                this.resetForm();
            },
            loadRecords: function () {
                const stored = localStorage.getItem('arthaNex_records');
                if (stored) this.state.records = JSON.parse(stored);
            },
            cleanupOldRecords: function () {
                if (!this.state.autoDeleteEnabled) return;
                const now = Date.now();
                const threeMonths = 90 * 24 * 60 * 60 * 1000;
                const filtered = this.state.records.filter(r => (now - r.timestamp) < threeMonths);
                if (filtered.length < this.state.records.length) {
                    this.state.records = filtered;
                    localStorage.setItem('arthaNex_records', JSON.stringify(this.state.records));
                }
            },
            resetForm: function () {
                if (this.state.selectedCountry) this.loadDenominations();
                document.getElementById('entryName').value = "";
                document.getElementById('entryName').classList.remove('error');
                document.getElementById('entryMobile').value = "";
                document.getElementById('entryRemarks').value = "";

                document.getElementById('entryStatus').value = 'Paid';
                document.getElementById('entryPayable').checked = false;
                document.querySelector('input[name="dueType"][value="receivable"]').checked = true;
                this.handleStatusChange();

                const now = new Date();
                document.getElementById('entryDate').valueAsDate = now;
                document.getElementById('entryTime').value = now.toTimeString().substring(0, 5);
            },

            renderOutstanding: function (filterType) {
                const list = document.getElementById('outstandingList');
                const empty = document.getElementById('outstandingEmpty');
                list.innerHTML = '';

                let dues = this.state.records.filter(r => r.status === 'Due');
                if (filterType === 'receivable') { dues = dues.filter(r => r.type === 'income'); }
                else if (filterType === 'payable') { dues = dues.filter(r => r.type === 'expense'); }

                if (dues.length === 0) {
                    empty.style.display = 'block';
                } else {
                    empty.style.display = 'none';
                    dues.sort((a, b) => b.timestamp - a.timestamp).forEach(r => {
                        const li = document.createElement('li');
                        li.className = 'history-item';
                        const typeBadge = r.type === 'income' ? '<span class="badge receivable">Receivable</span>' : '<span class="badge expense">Payable</span>';
                        const amountClass = r.type === 'income' ? 'amount-income' : 'amount-expense';

                        li.innerHTML = `
                            <div class="h-left">
                                <span class="h-name">${typeBadge} ${r.name}</span>
                                <div class="h-details">
                                    <div class="h-detail-row"><span>ðŸ“…</span> <span>${r.date}</span></div>
                                    <div class="h-detail-row"><span>ðŸ“</span> <span>${r.remarks || 'No remarks'}</span></div>
                                </div>
                            </div>
                            <div class="h-right">
                                <span class="h-amount ${amountClass}">${r.symbol} ${r.total.toLocaleString()}</span>
                                <button class="btn btn-success" style="margin-top:5px; padding:4px 8px; font-size:0.8rem;" onclick="app.settleDue(${r.id})">Mark Paid</button>
                            </div>
                        `;
                        list.appendChild(li);
                    });
                }
            },

            settleDue: function (id) {
                if (confirm('Mark this record as Paid/Cleared today?')) {
                    const rIndex = this.state.records.findIndex(r => r.id === id);
                    if (rIndex > -1) {
                        this.state.records[rIndex].status = 'Paid';
                        localStorage.setItem('arthaNex_records', JSON.stringify(this.state.records));
                        this.updateDashboard();
                        this.renderOutstanding('all');
                        this.showToast('Record marked as Paid!');
                    }
                }
            },

            suggestLedgerName: function (val) {
                const container = document.getElementById('ledgerSuggestions');
                container.innerHTML = '';
                if (val.length < 1) return;

                const names = [...new Set(this.state.records.map(r => r.name))].filter(n => n.toLowerCase().includes(val.toLowerCase()));
                names.forEach(name => {
                    const tag = document.createElement('span');
                    tag.textContent = name;
                    tag.style.cssText = "background:var(--light-bg); padding:4px 8px; border-radius:4px; font-size:0.8rem; border:1px solid var(--border); cursor:pointer; word-break: break-word;";
                    tag.onclick = () => {
                        document.getElementById('ledgerSearch').value = name;
                        this.loadLedger(name);
                        container.innerHTML = '';
                    };
                    container.appendChild(tag);
                });
            },

            loadLedger: function (name) {
                const custRecords = this.state.records.filter(r => r.name === name);
                if (custRecords.length === 0) return;

                document.getElementById('ledgerDetails').style.display = 'block';
                document.getElementById('ledgerEmpty').style.display = 'none';
                document.getElementById('ledgerCustomerName').textContent = name;

                const totalRec = custRecords.filter(r => r.type === 'income').reduce((sum, r) => sum + r.total, 0);
                const totalPaid = custRecords.filter(r => r.type === 'expense').reduce((sum, r) => sum + r.total, 0);

                document.getElementById('ledgerTotalReceived').textContent = totalRec.toLocaleString();
                document.getElementById('ledgerTotalPaid').textContent = totalPaid.toLocaleString();

                const net = totalRec - totalPaid;
                const netEl = document.getElementById('ledgerNetBalance');
                netEl.textContent = net.toLocaleString();
                netEl.style.color = net >= 0 ? 'var(--text-balance)' : 'var(--text-expense)';

                const list = document.getElementById('ledgerList');
                list.innerHTML = '';
                custRecords.sort((a, b) => b.timestamp - a.timestamp).forEach(r => {
                    const li = document.createElement('li');
                    li.className = 'history-item';
                    const amountClass = r.type === 'income' ? 'amount-income' : 'amount-expense';
                    li.innerHTML = `
                        <div class="h-left">
                            <span class="h-name">${r.date}</span>
                            <div class="h-details">
                                <div class="h-detail-row"><span>${r.remarks || 'No remarks'}</span></div>
                                <div class="h-detail-row"><span>Status:</span> <span>${r.status}</span></div>
                            </div>
                        </div>
                        <div class="h-right">
                            <span class="h-amount ${amountClass}">${r.symbol} ${r.total.toLocaleString()}</span>
                        </div>
                    `;
                    list.appendChild(li);
                });
            },

            clearLedger: function () {
                document.getElementById('ledgerSearch').value = '';
                document.getElementById('ledgerDetails').style.display = 'none';
                document.getElementById('ledgerEmpty').style.display = 'block';
                document.getElementById('ledgerSuggestions').innerHTML = '';
            },

            setFilterMode: function (mode) {
                this.state.filters.mode = mode;
                const inputs = document.querySelectorAll('.filter-input');
                inputs.forEach(input => input.style.display = 'none');

                if (mode === 'name') document.getElementById('filterName').style.display = 'block';
                else if (mode === 'date') document.getElementById('filterDate').style.display = 'block';
                else if (mode === 'amount') document.getElementById('filterAmount').style.display = 'block';

                this.renderHistory();
            },
            handleFilter: function (type, value) {
                if (this.state.filters.mode !== type) return;
                this.state.filters[type] = value;
                this.renderHistory();
            },
            closeAllMenus: function () { document.querySelectorAll('.item-menu').forEach(el => el.classList.remove('show')); },
            toggleMenu: function (id, event) {
                if (event) event.stopPropagation();
                this.closeAllMenus();
                const menu = document.getElementById(`menu-${id}`);
                if (menu) menu.classList.add('show');
            },
            renderHistory: function () {
                const list = document.getElementById('historyList');
                const emptyState = document.getElementById('emptyState');
                const { name, date, amount, mode } = this.state.filters;
                list.innerHTML = '';
                let data = [...this.state.records];

                const filtered = data.filter(r => {
                    if (mode === 'name') return name ? r.name.toLowerCase().includes(name.toLowerCase()) : true;
                    else if (mode === 'date') return date ? r.date === date : true;
                    else if (mode === 'amount') return amount ? r.total.toString().startsWith(amount.toString()) : true;
                    return true;
                });

                if (mode === 'amount') filtered.sort((a, b) => a.total - b.total);
                else filtered.sort((a, b) => b.timestamp - a.timestamp);

                if (filtered.length === 0) emptyState.style.display = 'block';
                else {
                    emptyState.style.display = 'none';
                    filtered.forEach(r => {
                        const li = document.createElement('li');
                        li.className = 'history-item';
                        let statusBadge = r.status === 'Due' ? '<span class="badge due">Due</span>' : '';
                        if (r.type === 'expense') statusBadge += '<span class="badge expense">Payable</span>';

                        const amountClass = r.type === 'expense' ? 'amount-expense' : 'amount-income';
                        const amountWords = this.numberToWords(r.total) + " " + r.currency;

                        li.innerHTML = `
                            <div class="h-left">
                                <span class="h-name">${statusBadge} ${r.name}</span>
                                <div class="h-details">
                                    ${r.mobile ? `<div class="h-detail-row"><span>ðŸ“±</span> <span>${r.mobile}</span></div>` : ''}
                                    ${r.remarks ? `<div class="h-detail-row"><span>ðŸ“</span> <span>${r.remarks}</span></div>` : ''}
                                    <div class="h-detail-row" style="font-size:0.75rem; opacity:0.8;">${r.date} &bull; ${r.country}</div>
                                </div>
                            </div>
                            <div class="h-right">
                                <span class="h-amount ${amountClass}">${r.symbol} ${r.total.toLocaleString()}</span>
                                <span class="h-words" title="${amountWords}">${amountWords}</span>
                                <div class="menu-container">
                                    <button class="btn-menu" onclick="app.toggleMenu(${r.id}, event)">â‹®</button>
                                    <div class="item-menu" id="menu-${r.id}">
                                        <button class="menu-opt" onclick="event.stopPropagation(); event.preventDefault(); app.downloadInvoice(${r.id})">ðŸ“„ Download Invoice</button>
                                        <button class="menu-opt" onclick="event.stopPropagation(); event.preventDefault(); app.viewRecord(${r.id})">ðŸ‘ View Details</button>
                                        <button class="menu-opt" onclick="event.stopPropagation(); event.preventDefault(); app.copyRecord(${r.id})">ðŸ“‹ Copy</button>
                                        <button class="menu-opt" onclick="event.stopPropagation(); event.preventDefault(); app.shareRecord(${r.id})">ðŸ”— Share</button>
                                        <button class="menu-opt delete" onclick="event.stopPropagation(); event.preventDefault(); app.deleteRecord(${r.id})">ðŸ—‘ Delete</button>
                                    </div>
                                </div>
                            </div>
                        `;
                        list.appendChild(li);
                    });
                }
            },
            openRangeModal: function () {
                this.toggleModal('dateRangeModal');
            },

            // --------------------------------------------------
            // PDF GENERATION LOGIC
            // --------------------------------------------------
            downloadInvoice: function (id) {
                const r = this.state.records.find(rec => rec.id === id);
                if (!r) return;

                this.showToast("Generating Invoice...");

                // 1. Invoice Title Logic
                let title = "INVOICE";
                if (r.status === 'Due') {
                    if (r.type === 'income') title = "INVOICE (DUE)";
                    else title = "BILL (DUE)";
                } else {
                    if (r.type === 'income') title = "RECEIPT";
                    else title = "PAYMENT RECEIPT";
                }

                // 2. Status Color Logic
                let statusClass = '';
                let statusText = '';
                if (r.status === 'Paid') {
                    statusClass = 'status-paid'; // Green
                    statusText = 'PAID';
                } else {
                    if (r.type === 'expense') {
                        statusClass = 'status-due-pay'; // Orange
                        statusText = 'DUE (PAYABLE)';
                    } else {
                        statusClass = 'status-due-rec'; // Red
                        statusText = 'DUE (RECEIVABLE)';
                    }
                }

                const typeLabel = r.type === 'income' ? 'Credit / Receivable' : 'Debit / Payable';
                const inWords = this.numberToWords(r.total) + " " + r.currency + " Only";

                // 3. Denominations Table (Only if exists)
                let denomSectionHtml = '';
                let denomRows = '';
                Object.keys(r.denominations).forEach(denom => {
                    const count = r.denominations[denom];
                    if (count > 0) {
                        const subtotal = (count * denom);
                        denomRows += `<tr><td>${r.symbol} ${denom}</td><td>${count}</td><td class="text-right">${r.symbol} ${subtotal.toLocaleString()}</td></tr>`;
                    }
                });

                if (denomRows !== '') {
                    denomSectionHtml = `
                        <div style="border: 1px dashed #ccc; padding: 15px; border-radius: 8px; margin-bottom: 40px; background-color: #fafafa;">
                            <h4 style="font-size: 10pt; margin: 0 0 10px 0; color: #555; text-transform: uppercase;">Payment Breakdown / Denominations</h4>
                            <table style="width: 100%; border-collapse: collapse; font-size: 9pt;">
                                <thead>
                                    <tr>
                                        <th style="background-color: #f0f0f0; color: #333; padding: 6px; border: 1px solid #ddd; text-align: left;">Denomination</th>
                                        <th style="background-color: #f0f0f0; color: #333; padding: 6px; border: 1px solid #ddd; text-align: left;">Count</th>
                                        <th style="background-color: #f0f0f0; color: #333; padding: 6px; border: 1px solid #ddd; text-align: right;">Subtotal</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${denomRows}
                                </tbody>
                            </table>
                        </div>
                    `;
                }

                // 4. HTML Template
                const content = `
                    <div class="pdf-paper">
                        <!-- Header -->
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; padding-bottom: 20px; border-bottom: 3px solid #F36C21; margin-bottom: 30px;">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <img src="${this.state.base64Icon}" style="width: 60px; height: 60px; object-fit: contain;" crossorigin="anonymous" alt="Logo">
                                <div>
                                    <h1 style="font-size: 24pt; color: #F36C21; margin: 0; line-height: 1.1; font-weight: 700;">ArthaNex</h1>
                                    <p style="margin: 4px 0 0 0; font-size: 10pt; color: #666; font-style: italic;">by Arthixa</p>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 28pt; font-weight: 800; text-transform: uppercase; color: #333; margin: 0 0 15px 0; letter-spacing: 1px;">${title}</div>
                                <div style="font-size: 10pt; color: #555; margin-bottom: 6px;"><strong>Invoice #:</strong> ${r.id}</div>
                                <div style="font-size: 10pt; color: #555; margin-bottom: 6px;"><strong>Date:</strong> ${r.date}</div>
                                <div style="font-size: 10pt; color: #555;"><strong>Time:</strong> ${r.time}</div>
                            </div>
                        </div>

                        <!-- Billing Info -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 30px;">
                            <div>
                                <h3 style="font-size: 10pt; text-transform: uppercase; color: #F36C21; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 10px; font-weight: 700;">Bill To</h3>
                                <div style="font-size: 10pt; color: #444;">
                                    <strong style="display: block; font-size: 12pt; color: #000; margin-bottom: 2px;">${r.name}</strong>
                                    ${r.mobile ? `<div style="margin-bottom: 4px;">Mobile: ${r.mobile}</div>` : ''}
                                    <div>Country: ${r.country}</div>
                                </div>
                            </div>
                            <div>
                                <h3 style="font-size: 10pt; text-transform: uppercase; color: #F36C21; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 10px; font-weight: 700;">Payment Details</h3>
                                <div style="font-size: 10pt; color: #444;">
                                    <div style="margin-bottom: 4px;"><strong>Status:</strong> <span class="${statusClass}">${statusText}</span></div>
                                    <div style="margin-bottom: 4px;"><strong>Type:</strong> ${typeLabel}</div>
                                    <div><strong>Currency:</strong> ${r.currency} (${r.symbol})</div>
                                </div>
                            </div>
                        </div>

                        <!-- Transaction Table -->
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px; font-size: 10pt;">
                            <thead>
                                <tr>
                                    <th style="background-color: #F36C21; color: #fff; padding: 12px 10px; text-align: left; font-weight: 600; border-bottom: 2px solid #F36C21; width: 60%;">Description</th>
                                    <th style="background-color: #F36C21; color: #fff; padding: 12px 10px; text-align: center; font-weight: 600; border-bottom: 2px solid #F36C21; width: 20%;">Quantity</th>
                                    <th style="background-color: #F36C21; color: #fff; padding: 12px 10px; text-align: right; font-weight: 600; border-bottom: 2px solid #F36C21; width: 20%;">Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="border-bottom: 1px solid #eee; padding: 12px 10px; vertical-align: top;">
                                        <strong>${r.remarks || 'Cash Collection'}</strong><br>
                                        <span style="font-size: 8pt; color: #666;">
                                            ${r.type === 'income' ? 'Amount Received from Customer' : 'Amount Paid to Customer'}
                                        </span>
                                    </td>
                                    <td class="text-center" style="border-bottom: 1px solid #eee; padding: 12px 10px;">1</td>
                                    <td class="text-right" style="border-bottom: 1px solid #eee; padding: 12px 10px;">${r.symbol} ${r.total.toLocaleString()}</td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Totals -->
                        <div style="display: flex; justify-content: flex-end; margin-bottom: 30px;">
                            <div style="width: 50%;">
                                <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #eee; font-size: 10pt;">
                                    <span>Subtotal:</span><span>${r.symbol} ${r.total.toLocaleString()}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #eee; font-size: 10pt;">
                                    <span>Tax / VAT:</span><span>${r.symbol} 0.00</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 6px 0; border-top: 2px solid #333; border-bottom: none; font-size: 14pt; font-weight: 800; margin-top: 10px; padding-top: 10px; color: #F36C21;">
                                    <span>Grand Total:</span><span>${r.symbol} ${r.total.toLocaleString()}</span>
                                </div>
                                <div style="font-style: italic; color: #666; font-size: 9pt; margin-top: 8px; text-align: right;"><strong>Amount in Words:</strong> ${inWords}</div>
                            </div>
                        </div>

                        ${denomSectionHtml}

                        <!-- Footer -->
                        <div style="margin-top: 50px; padding-top: 20px; border-top: 1px solid #eee; font-size: 9pt; color: #777;">
                            <div style="margin-bottom: 40px;">
                                <strong>Terms & Conditions</strong>
                                <ul style="padding-left: 20px; margin: 5px 0;">
                                    <li>This is a computer-generated invoice.</li>
                                    <li>Please verify cash denomination details carefully.</li>
                                    <li>For queries, please contact the issuer.</li>
                                </ul>
                            </div>
                            <div style="text-align: right; margin-bottom: 30px;">
                                <div style="display: inline-block; width: 200px; border-top: 1px solid #000; padding-top: 5px; font-weight: bold; color: #000;">Authorized Signature</div>
                            </div>
                            <div style="text-align: center; font-weight: bold; color: #F36C21; margin-top: 20px;">
                                Thank you for your business!<br>
                                Generated by ArthaNex App
                            </div>
                            <div style="text-align: center; margin-top: 10px; font-size: 8pt; color: #999;">
                                Page 1 of 1
                            </div>
                        </div>
                    </div>
                `;

                // 5. Render & Export
                const container = document.getElementById('pdf-render-container');
                container.innerHTML = content;
                container.style.display = 'block'; // Make visible for capture

                if (typeof html2pdf !== 'undefined') {
                    const opt = {
                        margin: [10, 10, 10, 10],
                        filename: `ArthaNex_${r.name}_${r.id}.pdf`,
                        image: { type: 'jpeg', quality: 0.98 },
                        html2canvas: { scale: 2, useCORS: true },
                        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                    };

                    setTimeout(() => {
                        html2pdf().set(opt).from(container).save().then(() => {
                            container.style.display = 'none'; // Hide after save
                        }).catch(err => {
                            console.error(err);
                            container.style.display = 'none'; // Hide on error
                            this.showToast("Error generating PDF. Trying Print...");
                            setTimeout(() => window.print(), 1000);
                        });
                    }, 500);

                } else {
                    // Fallback
                    setTimeout(() => window.print(), 500);
                    container.style.display = 'none';
                }
            },

            // --------------------------------------------------
            // NEW PDF REPORT LOGIC (Date Range & 30 Days)
            // --------------------------------------------------
            exportLast30Days: function () {
                const today = new Date();
                const thirtyDaysAgo = new Date(); thirtyDaysAgo.setDate(today.getDate() - 30);
                const startISO = thirtyDaysAgo.toISOString().split('T')[0];
                const endISO = today.toISOString().split('T')[0];
                const filtered = this.state.records.filter(r => r.date >= startISO && r.date <= endISO);
                if (filtered.length === 0) return this.showToast("No records in last 30 days.");

                this.generatePrintView(filtered, "30 Days Transaction Report", startISO, endISO);
            },
            executeRangeExport: function () {
                const start = document.getElementById('rangeStart').value;
                const end = document.getElementById('rangeEnd').value;
                if (!start || !end) return this.showToast("Please select both dates.");
                if (start > end) return this.showToast("Invalid date range.");
                const filtered = this.state.records.filter(r => r.date >= start && r.date <= end);
                if (filtered.length === 0) return this.showToast("No records found.");

                this.generatePrintView(filtered, "Transaction Report (Date Range)", start, end);
                this.toggleModal('dateRangeModal');
            },
            generatePrintView: function (records, titleText, startDateStr, endDateStr) {
                const container = document.getElementById('pdf-render-container');
                this.showToast("Generating Report...");

                if (!records || records.length === 0) {
                    container.innerHTML = `
                        <div class="pdf-paper">
                            <div class="empty-state-msg">No transactions available for selected period</div>
                        </div>`;
                    this.downloadPDF(titleText);
                    return;
                }

                // Helper: Format Date DD/MM/YYYY
                const fmtDate = (dateStr) => {
                    const parts = dateStr.split('-');
                    return `${parts[2]}/${parts[1]}/${parts[0]}`;
                };

                // Current Generated Time
                const generatedOn = new Date().toLocaleString();

                // Currency Symbol
                const currencySymbol = records[0].symbol || "";

                // --- Calculations for Summary ---
                const totalIncome = records.filter(r => r.type === 'income').reduce((sum, r) => sum + r.total, 0);
                const totalExpense = records.filter(r => r.type === 'expense').reduce((sum, r) => sum + r.total, 0);
                const totalReceivable = records.filter(r => r.type === 'income' && r.status === 'Due').reduce((sum, r) => sum + r.total, 0);
                const totalPayable = records.filter(r => r.type === 'expense' && r.status === 'Due').reduce((sum, r) => sum + r.total, 0);
                const netBalance = totalIncome - totalExpense;

                // --- Build Table Rows ---
                let rowsHtml = '';
                records.forEach((r, index) => {
                    // Color Coding Logic
                    let rowClass = '';
                    let statusClass = '';

                    if (r.status === 'Paid') {
                        rowClass = 'row-green';
                        statusClass = 'status-paid';
                    } else if (r.status === 'Due' && r.type === 'expense') {
                        rowClass = 'row-orange'; // Payable
                        statusClass = 'status-due-pay';
                    } else if (r.status === 'Due' && r.type === 'income') {
                        rowClass = 'row-red'; // Receivable
                        statusClass = 'status-due-rec';
                    }

                    const inWords = this.numberToWords(r.total) + " " + r.currency;

                    rowsHtml += `
                        <tr class="${rowClass}">
                            <td>${index + 1}</td>
                            <td>${fmtDate(r.date)}</td>
                            <td>${r.time}</td>
                            <td>${r.name}</td>
                            <td>${r.remarks || '-'}</td>
                            <td style="font-weight:bold; text-transform:uppercase;">${r.type}</td>
                            <td class="text-right" style="font-weight:bold;">${currencySymbol} ${r.total.toLocaleString()}</td>
                            <td style="font-size: 8pt; color: #555; word-break: break-word;">${inWords}</td>
                            <td class="text-center"><span class="${statusClass}">${r.status}</span></td>
                        </tr>
                    `;
                });

                // --- HTML Construction ---
                const content = `
                    <div class="pdf-paper">
                        <!-- Header -->
                        <div class="pdf-header">
                            <div class="pdf-brand">
                                <img src="${this.state.base64Icon}" class="pdf-logo" alt="Logo" crossorigin="anonymous">
                                <div class="pdf-brand-text">
                                    <h1>ArthaNex</h1>
                                    <p>by Arthixa</p>
                                </div>
                            </div>
                            <div class="pdf-title-block">
                                <div class="pdf-main-title">${titleText}</div>
                                <div class="pdf-date-info">
                                    <span>From: ${fmtDate(startDateStr)}</span>
                                    <span>To: ${fmtDate(endDateStr)}</span>
                                    <span style="margin-top:4px; font-style:italic;">Generated On: ${generatedOn}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Table -->
                        <table class="pdf-table">
                            <thead>
                                <tr>
                                    <th style="width: 5%;">Sl No</th>
                                    <th style="width: 10%;">Date</th>
                                    <th style="width: 8%;">Time</th>
                                    <th style="width: 15%;">Name / Party</th>
                                    <th style="width: 20%;">Remarks</th>
                                    <th style="width: 10%;">Type</th>
                                    <th style="width: 10%;" class="text-right">Amount</th>
                                    <th style="width: 12%;">Amount (In Words)</th>
                                    <th style="width: 10%;">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${rowsHtml}
                            </tbody>
                        </table>

                        <!-- Summary Section -->
                        <div class="pdf-summary">
                            <div class="summary-title">Summary</div>
                            <div class="summary-grid">
                                <div class="summary-item">
                                    <span class="summary-label">Total Income:</span>
                                    <span class="summary-val" style="color: #2e7d32;">${currencySymbol} ${totalIncome.toLocaleString()}</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">Total Expense:</span>
                                    <span class="summary-val" style="color: #c62828;">${currencySymbol} ${totalExpense.toLocaleString()}</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">Total Receivable (Due):</span>
                                    <span class="summary-val" style="color: #c62828;">${currencySymbol} ${totalReceivable.toLocaleString()}</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">Total Payable (Due):</span>
                                    <span class="summary-val" style="color: #e65100;">${currencySymbol} ${totalPayable.toLocaleString()}</span>
                                </div>
                                <div class="summary-item total-balance" style="grid-column: span 2;">
                                    <span class="summary-label">Net Balance:</span>
                                    <span class="summary-val">${currencySymbol} ${netBalance.toLocaleString()}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Footer -->
                        <div class="pdf-footer">
                            <span>Generated by ArthaNex</span>
                            <span>Page 1 of 1</span>
                        </div>
                    </div>
                `;

                container.innerHTML = content;
                this.downloadPDF(titleText);
            },

            downloadPDF: function (filenamePrefix) {
                const container = document.getElementById('pdf-render-container');
                container.style.display = 'block'; // Make visible for capture

                if (typeof html2pdf !== 'undefined') {
                    const opt = {
                        margin: [5, 5, 5, 5],
                        filename: `ArthaNex_Report_${filenamePrefix.replace(/ /g, '_')}.pdf`,
                        image: { type: 'jpeg', quality: 0.98 },
                        html2canvas: { scale: 2, useCORS: true },
                        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                    };
                    setTimeout(() => {
                        html2pdf().set(opt).from(container).save().then(() => {
                            container.style.display = 'none'; // Hide after
                        }).catch(err => {
                            console.error(err);
                            container.style.display = 'none';
                        });
                    }, 500);
                } else {
                    setTimeout(() => window.print(), 500);
                    container.style.display = 'none';
                }
            },

            viewRecord: function (id) {
                const r = this.state.records.find(rec => rec.id === id);
                if (!r) return;
                let breakdownHTML = '';
                Object.keys(r.denominations).forEach(denom => {
                    const count = r.denominations[denom];
                    if (count > 0) breakdownHTML += `<div class="denom-br-row"><span>${r.symbol} ${denom} x ${count}</span><span>${r.symbol} ${(count * denom).toLocaleString()}</span></div>`;
                });
                if (breakdownHTML === '') breakdownHTML = '<div style="text-align:center; padding:10px; opacity:0.7;">No denomination breakdown found.</div>';
                const inWords = this.numberToWords(r.total) + " " + r.currency;
                const typeBadge = r.type === 'expense' ? '<span class="badge expense">Payable</span>' : '<span class="badge receivable">Income</span>';
                const statusBadge = r.status === 'Due' ? '<span class="badge due">Due</span>' : '';

                let transactionText = "";
                if (r.type === 'income') { transactionText = (r.status === 'Paid') ? "Received From" : "Receivable From"; }
                else { transactionText = (r.status === 'Paid') ? "Paid To" : "Payable To"; }

                document.getElementById('detailContent').innerHTML = `
                    <div class="detail-row" style="font-size:1rem; border-bottom: 2px solid var(--border); margin-bottom:12px;">
                        <span>Transaction:</span> <span style="color:var(--primary); font-weight:700;">${transactionText} <span style="text-decoration:underline;">${r.name}</span></span>
                    </div>
                    <div class="detail-row"><span>Status:</span> <span>${typeBadge} ${statusBadge}</span></div>
                    <div class="detail-row"><span>Date:</span> <span>${r.date} ${r.time}</span></div>
                    <div class="detail-row"><span>Total:</span> <span style="color:var(--primary)">${r.symbol} ${r.total.toLocaleString()}</span></div>
                    <div class="detail-row"><span>In Words:</span> <span style="font-style:italic; font-size: 0.8rem;">${inWords}</span></div>
                    <div class="detail-row"><span>Remarks:</span> <span>${r.remarks || '-'}</span></div>
                    <h4 style="margin: 15px 0 10px 0; font-size: 0.9rem; color: var(--neutral);">Denomination Breakdown</h4>
                    <div class="denom-breakdown">${breakdownHTML}</div>
                `;
                this.toggleModal('viewDetailModal');
            },
            copyRecord: function (id) {
                const r = this.state.records.find(rec => rec.id === id);
                if (!r) return;

                let transactionText = "";
                if (r.type === 'income') { transactionText = (r.status === 'Paid') ? "Received From" : "Receivable From"; }
                else { transactionText = (r.status === 'Paid') ? "Paid To" : "Payable To"; }

                const text = `Transaction: ${transactionText} ${r.name}\nAmount: ${r.symbol}${r.total}\nStatus: ${r.status}\nDate: ${r.date}\nRemarks: ${r.remarks}`;
                if (navigator.clipboard) navigator.clipboard.writeText(text).then(() => this.showToast("Copied!")).catch(() => this.showToast("Failed"));
                else this.showToast("Clipboard not supported");
            },
            shareRecord: function (id) {
                const r = this.state.records.find(rec => rec.id === id);
                if (!r) return;

                let transactionText = "";
                if (r.type === 'income') { transactionText = (r.status === 'Paid') ? "Received From" : "Receivable From"; }
                else { transactionText = (r.status === 'Paid') ? "Paid To" : "Payable To"; }

                const msg = `ArthaNex:\nTransaction: ${transactionText} ${r.name}\nAmount: ${r.symbol}${r.total}\nDate: ${r.date}\n\nDownload App: https://arthixa.com`;
                if (navigator.share) navigator.share({ title: 'Record', text: msg }).catch(console.error);
                else this.showToast("Share not supported");
            },
            deleteRecord: function (id) {
                const recordId = Number(id);
                const index = this.state.records.findIndex(r => r.id === recordId);

                if (index === -1) {
                    this.showToast("Record not found.");
                    return;
                }

                if (confirm("Are you sure you want to delete this record?")) {
                    this.state.records.splice(index, 1);
                    localStorage.setItem('arthaNex_records', JSON.stringify(this.state.records));
                    this.updateDashboard();
                    this.closeAllMenus();
                    this.renderHistory();
                    this.showToast("Record deleted.");
                }
            },
            showToast: function (msg) {
                const el = document.getElementById('toast');
                el.textContent = msg; el.className = "show";
                setTimeout(() => { el.className = el.className.replace("show", ""); }, 3000);
            },
            numberToWords: function (num) {
                if (num === 0) return "Zero";
                const a = ['', 'One ', 'Two ', 'Three ', 'Four ', 'Five ', 'Six ', 'Seven ', 'Eight ', 'Nine ', 'Ten ', 'Eleven ', 'Twelve ', 'Thirteen ', 'Fourteen ', 'Fifteen ', 'Sixteen ', 'Seventeen ', 'Eighteen ', 'Nineteen '];
                const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];

                const numStr = num.toString();
                const n = ('00000000000' + numStr).substr(-11).match(/^(\d{2})(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);
                if (!n) return numStr;

                let str = '';
                str += (n[1] != 0) ? (a[Number(n[1])] || b[n[1][0]] + ' ' + a[n[1][1]]) + 'Arab ' : '';
                str += (n[2] != 0) ? (a[Number(n[2])] || b[n[2][0]] + ' ' + a[n[2][1]]) + 'Crore ' : '';
                str += (n[3] != 0) ? (a[Number(n[3])] || b[n[3][0]] + ' ' + a[n[3][1]]) + 'Lakh ' : '';
                str += (n[4] != 0) ? (a[Number(n[4])] || b[n[4][0]] + ' ' + a[n[4][1]]) + 'Thousand ' : '';
                str += (n[5] != 0) ? (a[Number(n[5])] || b[n[5][0]] + ' ' + a[n[5][1]]) + 'Hundred ' : '';
                str += (n[6] != 0) ? ((str != '') ? 'and ' : '') + (a[Number(n[6])] || b[n[6][0]] + ' ' + a[n[6][1]]) : '';

                return str.trim();
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });

    </script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    }, err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>

</body>

</html>
